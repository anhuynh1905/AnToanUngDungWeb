{"ast":null,"code":"var _jsxFileName = \"D:\\\\HK3-N2\\\\ANTOANHETHONGWEB\\\\BT5\\\\frontend\\\\src\\\\pages\\\\BookListPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useMemo } from 'react'; // <<< Thêm useMemo\nimport { getBooks } from '../services/api';\nimport { useAuth } from '../contexts/AuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction BookListPage() {\n  _s();\n  const [allBooks, setAllBooks] = useState([]); // <<< Đổi tên state để lưu tất cả sách gốc\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const {\n    logout\n  } = useAuth();\n\n  // --- State cho tìm kiếm ---\n  const [searchQuery, setSearchQuery] = useState(''); // <<< State lưu nội dung tìm kiếm\n\n  // Hàm fetch sách (không đổi nhiều)\n  const fetchBooks = async () => {\n    setLoading(true);\n    setError('');\n    try {\n      var _response$data;\n      const response = await getBooks();\n      setAllBooks(response.data || []); // <<< Lưu vào allBooks\n      console.log(\"BookListPage: Books fetched successfully.\", ((_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.length) || 0);\n    } catch (err) {\n      console.error(\"Failed to fetch books:\", err);\n      if (err.response && (err.response.status === 401 || err.response.status === 403)) {\n        setError('Your session may have expired. Please log in again.');\n        setTimeout(logout, 2000);\n      } else {\n        setError('Failed to load books. Please try refreshing the page.');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Gọi fetchBooks khi component mount\n  useEffect(() => {\n    fetchBooks();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // Chỉ chạy 1 lần\n\n  // --- Hàm xử lý thay đổi nội dung tìm kiếm ---\n  const handleSearchChange = event => {\n    setSearchQuery(event.target.value); // Cập nhật state searchQuery\n  };\n\n  // --- Lọc danh sách sách dựa trên searchQuery ---\n  // Sử dụng useMemo để chỉ tính toán lại danh sách lọc khi allBooks hoặc searchQuery thay đổi\n  const filteredBooks = useMemo(() => {\n    if (!searchQuery) {\n      return allBooks; // Trả về tất cả sách nếu không có query\n    }\n    const lowerCaseQuery = searchQuery.toLowerCase(); // Chuyển query sang chữ thường để tìm không phân biệt hoa thường\n    return allBooks.filter(book =>\n    // Tìm trong tiêu đề HOẶC tác giả\n    book.title && book.title.toLowerCase().includes(lowerCaseQuery) || book.author && book.author.toLowerCase().includes(lowerCaseQuery)\n    // Bạn có thể thêm tìm kiếm theo ISBN, mô tả,... nếu muốn\n    // (book.isbn && book.isbn.toLowerCase().includes(lowerCaseQuery))\n    );\n  }, [allBooks, searchQuery]); // Dependencies của useMemo\n\n  // --- UI Rendering ---\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loading\",\n    children: \"Loading books...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 23\n  }, this);\n  if (error) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 48\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 21\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Available Books\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: '20px'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Search by title or author...\",\n        value: searchQuery,\n        onChange: handleSearchChange // <<< Gọi hàm xử lý khi nhập\n        ,\n        style: {\n          padding: '8px',\n          width: 'calc(100% - 20px)',\n          border: '1px solid #ccc',\n          borderRadius: '4px'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), filteredBooks.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"No books found\", searchQuery ? ` matching \"${searchQuery}\"` : '', \".\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 10\n    }, this) // Thông báo tùy theo có tìm kiếm hay không\n    : /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: filteredBooks.map(book => /*#__PURE__*/_jsxDEV(\"li\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"book-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: book.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 18\n          }, this), \" by \", book.author || 'N/A', /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 18\n          }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n            children: [\"ISBN: \", book.isbn || 'N/A', \" | Qty: \", book.quantity, \" | Category: \", book.category_name || 'N/A']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 18\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 16\n        }, this)\n      }, book.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this);\n}\n_s(BookListPage, \"ihKwCI9PRR/Pcvftdyj4pZ/4YGg=\", false, function () {\n  return [useAuth];\n});\n_c = BookListPage;\nexport default BookListPage;\nvar _c;\n$RefreshReg$(_c, \"BookListPage\");","map":{"version":3,"names":["React","useState","useEffect","useMemo","getBooks","useAuth","jsxDEV","_jsxDEV","BookListPage","_s","allBooks","setAllBooks","loading","setLoading","error","setError","logout","searchQuery","setSearchQuery","fetchBooks","_response$data","response","data","console","log","length","err","status","setTimeout","handleSearchChange","event","target","value","filteredBooks","lowerCaseQuery","toLowerCase","filter","book","title","includes","author","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","marginBottom","type","placeholder","onChange","padding","width","border","borderRadius","map","isbn","quantity","category_name","id","_c","$RefreshReg$"],"sources":["D:/HK3-N2/ANTOANHETHONGWEB/BT5/frontend/src/pages/BookListPage.js"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react'; // <<< Thêm useMemo\r\nimport { getBooks } from '../services/api';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\nfunction BookListPage() {\r\n  const [allBooks, setAllBooks] = useState([]); // <<< Đổi tên state để lưu tất cả sách gốc\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const { logout } = useAuth();\r\n\r\n  // --- State cho tìm kiếm ---\r\n  const [searchQuery, setSearchQuery] = useState(''); // <<< State lưu nội dung tìm kiếm\r\n\r\n  // Hàm fetch sách (không đổi nhiều)\r\n  const fetchBooks = async () => {\r\n    setLoading(true);\r\n    setError('');\r\n    try {\r\n      const response = await getBooks();\r\n      setAllBooks(response.data || []); // <<< Lưu vào allBooks\r\n      console.log(\"BookListPage: Books fetched successfully.\", response.data?.length || 0);\r\n    } catch (err) {\r\n      console.error(\"Failed to fetch books:\", err);\r\n      if (err.response && (err.response.status === 401 || err.response.status === 403)) {\r\n        setError('Your session may have expired. Please log in again.');\r\n        setTimeout(logout, 2000);\r\n      } else {\r\n        setError('Failed to load books. Please try refreshing the page.');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Gọi fetchBooks khi component mount\r\n  useEffect(() => {\r\n    fetchBooks();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []); // Chỉ chạy 1 lần\r\n\r\n  // --- Hàm xử lý thay đổi nội dung tìm kiếm ---\r\n  const handleSearchChange = (event) => {\r\n    setSearchQuery(event.target.value); // Cập nhật state searchQuery\r\n  };\r\n\r\n  // --- Lọc danh sách sách dựa trên searchQuery ---\r\n  // Sử dụng useMemo để chỉ tính toán lại danh sách lọc khi allBooks hoặc searchQuery thay đổi\r\n  const filteredBooks = useMemo(() => {\r\n    if (!searchQuery) {\r\n      return allBooks; // Trả về tất cả sách nếu không có query\r\n    }\r\n    const lowerCaseQuery = searchQuery.toLowerCase(); // Chuyển query sang chữ thường để tìm không phân biệt hoa thường\r\n    return allBooks.filter(book =>\r\n      // Tìm trong tiêu đề HOẶC tác giả\r\n      (book.title && book.title.toLowerCase().includes(lowerCaseQuery)) ||\r\n      (book.author && book.author.toLowerCase().includes(lowerCaseQuery))\r\n      // Bạn có thể thêm tìm kiếm theo ISBN, mô tả,... nếu muốn\r\n      // (book.isbn && book.isbn.toLowerCase().includes(lowerCaseQuery))\r\n    );\r\n  }, [allBooks, searchQuery]); // Dependencies của useMemo\r\n\r\n  // --- UI Rendering ---\r\n  if (loading) return <div className=\"loading\">Loading books...</div>;\r\n  if (error) return <div className=\"container\"><p className=\"error-message\">{error}</p></div>;\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <h2>Available Books</h2>\r\n\r\n      {/* --- Thanh Tìm kiếm --- */}\r\n      <div style={{ marginBottom: '20px' }}>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search by title or author...\"\r\n          value={searchQuery}\r\n          onChange={handleSearchChange} // <<< Gọi hàm xử lý khi nhập\r\n          style={{ padding: '8px', width: 'calc(100% - 20px)', border: '1px solid #ccc', borderRadius: '4px' }}\r\n        />\r\n      </div>\r\n      {/* -------------------- */}\r\n\r\n      {/* Hiển thị danh sách sách đã lọc (filteredBooks) */}\r\n      {filteredBooks.length === 0 ? (\r\n         <p>No books found{searchQuery ? ` matching \"${searchQuery}\"` : ''}.</p> // Thông báo tùy theo có tìm kiếm hay không\r\n      ) : (\r\n        <ul>\r\n          {/* Lặp qua danh sách đã lọc */}\r\n          {filteredBooks.map((book) => (\r\n            <li key={book.id}>\r\n               <div className=\"book-info\">\r\n                 <strong>{book.title}</strong> by {book.author || 'N/A'}\r\n                 <br/>\r\n                 <small>ISBN: {book.isbn || 'N/A'} | Qty: {book.quantity} | Category: {book.category_name || 'N/A'}</small>\r\n              </div>\r\n              {/* TODO: Thêm nút \"Add to Draft\" nếu cần */}\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default BookListPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}